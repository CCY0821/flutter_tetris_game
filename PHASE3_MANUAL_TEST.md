# 惡魔方塊階段三 - 手動測試檢查清單

## 📋 測試前準備

### 啟動遊戲
```bash
flutter run
```

### 快速觸發惡魔方塊的方法
由於第一個惡魔方塊需要達到 10,000 分，建議：
- **方法 1**：正常遊玩至 10,000 分（約 5-8 分鐘）
- **方法 2**：使用符文快速消行加速得分
- **方法 3**（開發測試）：臨時修改觸發門檻到 1,000 分

---

## ✅ 測試清單（5個核心功能）

### 🎨 測試 3.1：惡魔方塊徑向漸層渲染

**觸發條件**：分數達到 10,000 分

**預期視覺效果**：
- [ ] Next Piece 預覽中出現金紅色方塊
- [ ] 方塊形狀為 10 格不規則連續形狀
- [ ] 每一格都是**徑向漸層**：
  - 中心：金色 (#FFD700)
  - 邊緣：深紅色 (#DC143C)
- [ ] 深紅色邊框（2px，#8B0000）
- [ ] 方塊落下時保持漸層效果
- [ ] 鎖定到棋盤後仍保持漸層效果

**測試步驟**：
1. 玩到 10,000 分
2. 觀察 Next Piece 區域是否出現金紅漸層方塊
3. 讓惡魔方塊下落
4. 仔細觀察每一格的漸層效果（金色中心→紅色邊緣）
5. 鎖定方塊後檢查棋盤上的方塊是否保持漸層

**❌ 常見問題**：
- 如果看到純金色方塊（無漸層）→ shader 未生效
- 如果看到普通顏色方塊 → 類型判斷錯誤
- 如果邊框不清晰 → 邊框繪製問題

---

### 👻 測試 3.2：幽靈方塊預覽系統

**觸發條件**：遊戲中任何方塊（包含惡魔方塊）

**預期視覺效果**：
- [ ] 所有方塊都顯示半透明幽靈預覽
- [ ] 幽靈方塊位置 = 硬降落點
- [ ] **惡魔方塊幽靈**特殊效果：
  - 保持金紅徑向漸層（不是純色）
  - 半透明 (opacity: 0.4)
  - 半透明深紅邊框
- [ ] 一般方塊幽靈：半透明 + 虛線邊框

**測試步驟**：
1. 開始遊戲，觀察任何方塊下方的幽靈預覽
2. 左右移動方塊，確認幽靈跟隨移動
3. 玩到惡魔方塊出現
4. **重點**：觀察惡魔方塊的幽靈預覽
   - 應該看到半透明的金紅漸層（不是灰色或純色）
5. 移動惡魔方塊，確認幽靈正確顯示落點

**驗證方法**：
- 按硬降（向下箭頭到底），方塊應該落到幽靈位置

**❌ 常見問題**：
- 幽靈方塊是灰色 → 未使用惡魔方塊專用渲染
- 幽靈位置不對 → 計算邏輯錯誤
- 看不到幽靈 → Ghost Piece 功能未啟用

---

### ⚠️ 測試 3.3：Next Piece 預警動畫

**觸發條件**：下一個方塊為惡魔方塊

**預期視覺效果**：
- [ ] **紅色脈動光環**：
  - 週期：1.0 秒
  - Opacity 變化：0.5 ↔ 1.0
  - 顏色：深紅 (#DC143C)
  - 範圍：Next Piece 周圍 15px 模糊
- [ ] **警告文字「⚠️ 惡魔方塊」**：
  - 位置：Next Piece 下方
  - 顏色：紅色粗體
  - 文字也有脈動效果（opacity 跟隨光環）
- [ ] 動畫流暢，無卡頓

**測試步驟**：
1. 玩到接近 10,000 分（例如 9,500 分）
2. **關鍵時刻**：消行達到 10,000 分後
3. 立即觀察 **Next Piece 區域**（右上角）
4. 應該看到：
   - 金紅漸層方塊
   - 周圍紅色光環持續脈動（呼吸效果）
   - 下方顯示「⚠️ 惡魔方塊」文字
5. 等待 1-2 秒，確認動畫循環流暢

**時間線**：
```
分數 9,800 → 消行 → 達到 10,000+
              ↓
      Next Piece 變為惡魔方塊
              ↓
      立即出現紅色脈動 + 警告文字
```

**❌ 常見問題**：
- 無脈動效果 → AnimationController 未啟動
- 光環不明顯 → BoxShadow 參數太小
- 文字不顯示 → 條件判斷錯誤

---

### 🔥 測試 3.4：分數加成計時器 UI

**觸發條件**：放置惡魔方塊到棋盤

**預期視覺效果**：
- [ ] **計時器出現位置**：分數面板下方
- [ ] **計時器內容**：
  - 左側：🔥 圖示 + "三倍加成" 文字（金色）
  - 右側：倒數計時 "10.0s"（金色）
  - 下方：紅到黃漸層進度條
- [ ] **倒數效果**：
  - 數字每 0.05 秒更新一次
  - 進度條同步遞減
  - 剩餘時間越少，進度條越紅
- [ ] **最後 3 秒閃爍**：
  - 整個計時器 opacity 0.3 ↔ 1.0 閃爍
  - 閃爍週期：0.5 秒
  - 時間文字變紅色
- [ ] **疊加測試**：
  - 連續放置 2 個惡魔方塊
  - 時間應該疊加（例如：剩 5s + 10s = 15s）
- [ ] **計時結束**：
  - 淡出消失（0.3秒動畫）

**測試步驟**：

**基礎測試**：
1. 讓惡魔方塊鎖定到棋盤
2. **立即觀察分數下方**應該出現計時器
3. 確認顯示 "10.0s"
4. 觀察倒數：10.0 → 9.9 → 9.8 ...
5. 觀察進度條從滿格遞減
6. 等到剩 3 秒，確認閃爍效果
7. 等到 0 秒，確認計時器消失

**疊加測試**（困難）：
1. 第一個惡魔方塊鎖定 → 計時器顯示 10.0s
2. 等 5 秒 → 計時器顯示約 5.0s
3. 立即觸發第二個惡魔方塊並鎖定
4. **驗證**：計時器應顯示約 15.0s（5 + 10）

**暫停測試**：
1. 惡魔方塊鎖定後計時器啟動
2. 按暫停鍵
3. **驗證**：計時器停止倒數
4. 恢復遊戲
5. **驗證**：計時器從暫停的時間繼續倒數

**❌ 常見問題**：
- 計時器不出現 → multiplierEndTime 未設置
- 時間不減少 → Timer 未啟動
- 無閃爍效果 → BlinkController 邏輯錯誤
- 暫停失效 → pauseGame 邏輯未實現

---

### 🔒 測試 3.5：旋轉按鈕禁用

**觸發條件**：當前方塊為惡魔方塊

**預期視覺效果**：
- [ ] **旋轉按鈕變灰**：
  - 左旋轉按鈕（Icons.rotate_left）
  - 右旋轉按鈕（Icons.rotate_right）
  - 按鈕 opacity 降低到 0.3
  - 霓虹光環消失
- [ ] **按鈕無法點擊**：
  - 點擊無任何反應
  - 無按下動畫
  - 無音效
- [ ] **其他按鈕正常**：
  - 左移、右移、下移、硬降仍可用
  - 這些按鈕保持正常亮度

**測試步驟**：

**視覺測試**：
1. 正常方塊時觀察旋轉按鈕（應該是亮的）
2. 惡魔方塊下落時
3. **立即觀察旋轉按鈕**：
   - 左旋轉按鈕應變灰
   - 右旋轉按鈕應變灰
4. 鎖定惡魔方塊後，下一個方塊如果不是惡魔
5. **驗證**：旋轉按鈕恢復正常亮度

**功能測試**：
1. 惡魔方塊下落中
2. 嘗試點擊旋轉按鈕
3. **驗證**：方塊不旋轉（因為惡魔方塊本來就不能旋轉）
4. **驗證**：按鈕無視覺反饋（無按下效果）

**對比測試**：
1. 惡魔方塊時，嘗試點擊**左移按鈕**
2. **驗證**：左移按鈕有反應，方塊正常左移
3. 這確認只有旋轉按鈕被禁用

**❌ 常見問題**：
- 按鈕未變灰 → isRotateDisabled 未傳遞
- 仍可點擊 → onPressed 邏輯錯誤
- 所有按鈕都變灰 → isDisabled 邏輯錯誤

---

## 🎬 完整流程測試（推薦）

按照時間線測試所有功能：

### 階段 1：觸發前（0 - 9,999 分）
- [ ] 正常方塊都有幽靈預覽
- [ ] 旋轉按鈕正常可用

### 階段 2：首次觸發（10,000 分）
- [ ] **Next Piece 出現預警**：
  - 紅色脈動光環
  - "⚠️ 惡魔方塊" 文字
  - 金紅漸層方塊預覽
- [ ] 旋轉按鈕保持正常（因為當前方塊還不是惡魔）

### 階段 3：惡魔方塊下落
- [ ] **當前方塊變為惡魔方塊時**：
  - 旋轉按鈕立即變灰
  - 方塊顯示金紅徑向漸層
  - 幽靈方塊也是半透明金紅漸層
- [ ] 左右移動正常
- [ ] 幽靈方塊跟隨移動

### 階段 4：鎖定惡魔方塊
- [ ] 方塊鎖定後，棋盤上保持金紅漸層
- [ ] **分數下方立即出現計時器**：
  - 顯示 "10.0s"
  - 進度條滿格
  - 開始倒數

### 階段 5：加成期間（10 秒）
- [ ] 計時器持續倒數
- [ ] 進度條遞減
- [ ] 消行時分數 ×3（可選驗證）
- [ ] 剩 3 秒時開始閃爍

### 階段 6：計時結束
- [ ] 計時器淡出消失
- [ ] 分數恢復正常倍率

### 階段 7：下一個方塊
- [ ] 如果下個方塊不是惡魔：
  - Next Piece 無預警
  - 旋轉按鈕恢復正常

---

## 📊 測試結果記錄表

| 功能 | 狀態 | 問題描述 |
|------|------|---------|
| 3.1 徑向漸層渲染 | ⬜ 通過 / ⬜ 失敗 | |
| 3.2 幽靈方塊預覽 | ⬜ 通過 / ⬜ 失敗 | |
| 3.3 Next Piece 預警 | ⬜ 通過 / ⬜ 失敗 | |
| 3.4 分數加成計時器 | ⬜ 通過 / ⬜ 失敗 | |
| 3.5 旋轉按鈕禁用 | ⬜ 通過 / ⬜ 失敗 | |

---

## 🐛 問題排查

如果遇到問題，檢查：

1. **惡魔方塊未出現**
   - 檢查分數是否真的達到 10,000
   - 檢查 DemonSpawnManager 是否正常運作
   ```bash
   # 查看日誌
   flutter run | grep -i "demon"
   ```

2. **視覺效果異常**
   - 重新啟動 app（hot reload 可能不完整）
   - 檢查 Flutter 版本是否支持 RadialGradient

3. **動畫不流暢**
   - 檢查設備性能
   - 查看是否有 60 FPS
   ```bash
   # 使用 profile 模式
   flutter run --profile
   ```

---

## ✅ 驗收標準

階段三算**完全通過**的條件：

- ✅ 所有 5 個測試項目都通過
- ✅ 無明顯視覺 bug
- ✅ 動畫流暢（60 FPS）
- ✅ 無崩潰或錯誤日誌
- ✅ 符合設計文檔的視覺規格

---

## 🎥 建議錄製

為了記錄測試結果，建議錄製：
1. 從 9,500 分到首次惡魔方塊出現
2. 惡魔方塊下落全過程
3. 計時器完整 10 秒倒數
4. 最後 3 秒閃爍效果

時間：約 1-2 分鐘影片即可

---

**測試完成後，請回報結果或遇到的問題！**
